@model EPiServer.Marketing.Testing.Data.ABTest
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>TestDetails</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript">
        var updateBoth = function (testId, variantId) {
		for (i = 0; i < 100; i++) {
		    $.ajax({
			type: 'POST',
			url: '/api/episerver/testing/updateview',
			cache: false,
			contentType: 'application/x-www-form-urlencoded',
			data: { testId: testId, variantId: variantId }
		    }).done(function (data) {
		    }).fail(function () {
		    }).always(function () {
			setTimeout(function(){ window.location.reload(); }, 2000);
		    });

		    $.ajax({
			type: 'POST',
			url: '/api/episerver/testing/updateconversion/',
			cache: false,
			contentType: 'application/x-www-form-urlencoded',
			data: { testId: testId, variantId: variantId }
		    }).done(function (data) {
		    }).fail(function () {
		    }).always(function () {
			setTimeout(function(){ window.location.reload(); }, 2000);
		    });

		}
        };

        var updateView = function (testId, variantId) {
		for (i = 0; i < 100; i++) {
		    $.ajax({
			type: 'POST',
			url: '/api/episerver/testing/updateview',
			cache: false,
			contentType: 'application/x-www-form-urlencoded',
			data: { testId: testId, variantId: variantId }
		    }).done(function (data) {
		    }).fail(function () {
		    }).always(function () {
			setTimeout(function(){ window.location.reload(); }, 2000);
		    });
		}
        };

        var updateConversion = function (testId, variantId) {
		for (i = 0; i < 100; i++) {
		    $.ajax({
			type: 'POST',
			url: '/api/episerver/testing/updateconversion/',
			cache: false,
			contentType: 'application/x-www-form-urlencoded',
			data: { testId: testId, variantId: variantId }
		    }).done(function (data) {
		    }).fail(function () {
		    }).always(function () {
			setTimeout(function(){ window.location.reload(); }, 2000);
		    });
		}
        };
    </script>
</head>
<body>
    <fieldset>
        <legend>MultivariateTest</legend>
        <div class="display-label">
            @Html.DisplayFor(model => model.Id)
        </div>
        <div class="display-label">
            @Html.DisplayNameFor(model => model.State) : @Html.DisplayFor(model => model.State)
        </div>


        <div class="display-label">
            @Html.DisplayNameFor(model => model.Title) : @Html.DisplayFor(model => model.Title)
        </div>

        <div class="display-label">
            @Html.DisplayNameFor(model => model.Owner) : @Html.DisplayFor(model => model.Owner)
        </div>

        <div class="display-label">
            @Html.DisplayNameFor(model => model.StartDate) : @Html.DisplayFor(model => model.StartDate)
        </div>

        <div class="display-label">
            @Html.DisplayNameFor(model => model.EndDate) : @Html.DisplayFor(model => model.EndDate)
        </div>

        <div class="display-label">
            @Html.DisplayNameFor(model => model.OriginalItemId) : @Html.DisplayFor(model => model.OriginalItemId)
        </div>



        <hr />
        @if (Model.TestResults != null)
        {
            <table style="width:50%">
                @foreach (var result in Model.TestResults)
                {
                    <tr><td> @Html.DisplayNameFor(resultItem => result.ItemId)</td><td> @Html.DisplayFor(resultItem => result.ItemId) version: @Html.DisplayFor(resultItem => result.ItemVersion) </td></tr>
                    <tr>
                        <td>@Html.DisplayNameFor(resultItem => result.Views)</td>
                        <td>@Html.DisplayFor(resultItem => result.Views)</td>
                        <td><input class="epi-cmsButton-text epi-cmsButton-tools epi-cmsButton-Cancel" type="button" name="btnUpdateViews" id="btnUpdateViews" value="REST Update View (+100)" title="UpdateView" onclick="updateView('@Model.Id','@result.ItemId');" /></td>
                    </tr>
                    <tr>
                        <td>@Html.DisplayNameFor(resultItem => result.Conversions)</td>
                        <td>@Html.DisplayFor(resultItem => result.Conversions)</td>
                        <td><input class="epi-cmsButton-text epi-cmsButton-tools epi-cmsButton-Cancel" type="button" name="btnUpdateConversions" id="btnUpdateConversions" value="REST Update Conversion (+100)" title="UpdateConversion" onclick="updateConversion('@Model.Id', '@result.ItemId');" /></td>
                        <td>&nbsp;</td>
                        <td><input class="epi-cmsButton-text epi-cmsButton-tools epi-cmsButton-Cancel" type="button" name="btnUpdateBoth" id="btnUpdateBoth" value="REST Update Views And Conversion (+100)" title="UpdateBoth" onclick="updateBoth('@Model.Id', '@result.ItemId');" /></td>
                    </tr>
                    <tr><td>&nbsp;</td></tr> }
            </table>
        }
    </fieldset>
    <p>
        @Html.ActionLink("Start & Stop Test", "RunAbTests", new { id = Model.Id }) |
        @Html.ActionLink("Start", "StartTest", new { id = Model.Id })
        @Html.ActionLink("Archive", "ArchiveAbTest", new { id = Model.Id }) |
        @Html.ActionLink("Edit", "UpdateAbTest", new { id = Model.Id }) |
        @Html.ActionLink("Back to List", "Index")
    </p>
</body>
</html>