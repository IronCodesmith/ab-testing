--beginvalidatingquery
	if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[sp_DatabaseVersion]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
    begin
		 select 1, 'Upgrading database'
    end
    else
		select -1, 'Not an EPiServer database'
--endvalidatingquery

-- Create MultivariateTest Tables to Store MultivariateTest Information.
DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Testing.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '1'

IF @CurrentMigration < '201611161702210_AddAutoPublishToTest'
BEGIN
   ALTER TABLE [dbo].[tblABTest] ADD [AutoPublishWinner] [bit] NOT NULL DEFAULT 0
	INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
	VALUES (N'201611161702210_AddAutoPublishToTest', N'Testing.Migrations.Configuration',  0x1F8B0800000000000400ED5D5B6FE4B6157E2FD0FF20E8A92D1C8FBDFB921A3309BCBE0483ACD786C7768BBE2C6889332622511391726C04FD6579C84FEA5FE8D1E84652A2444AB2770636F290312F1FC9C37323750EF77F7FFC39FDF1290C9C471C3312D1997BB87FE03A987A914FE86AE6267CF9DDF7EE8F3FFCF52FD3333F7C72EE8A761FD376D093B299FBC0F9FA683261DE030E11DB0F8917472C5AF27D2F0A27C88F261F0E0EFE39393C9C60807001CB71A6D709E524C49B3FE0CF93887A78CD13145C443E0E585E0E358B0DAAF3058598AD918767EED91559E01866BC7F81E25F308789EEDF60B6F9FF290A5CE7382008A6B5C0C1D27510A511471C267D74CBF082C7115D2DD65080829BE73586764B14309C2FE6A86A6EBAAE830FE9BA2655C702CA4B188F424BC0C38F39A1266AF75EE4764B420229CF80E4FC395DF5869C3317A875FC29259DEBA8A31D9D0471DAB293DCFB19EA66DBF64BC03D276FB257B20C7056FADF9E7392043C89F18CE284C728D873AE92FB80783FE3E79BE8174C6734090271DE3073A8930AA0E82A8ED638E6CFD77899AF66EEBBCE44EE37513B96DD843ED9327F4A08FCFE0263A3FB00975C3169ED7E4378800B04E02D58B0EB5CA0A7CF98AEF8C3CC859FAE734E9EB05F94E4B0B794808841271E27D87AD853CCBC98AC33AE183C78FB5897BF511CBFFE122F63B2221405738EC3819BB4008EAE36099442CAA6297BE615F670313F1520D3DF37A0CBAC91CEA83F0ACE154C887864BD11DC2B1C7B9872B42A71E7947FFC600DFA19310E424D9604FB9F9E5B18E0F0E06004363B7B5A638F63FF8E30C2A3F82402FBA02CA01DE0D84BAD474B77CBF583455A121F2C21FE8C1F71506E5204CACA7E8BFEB3F0A2180F0499B3055951D8110F55ABFB14450146D41AEC38E1D146F1B2877F112AC8785FC0931803038FC3D105E3F503FB821EC92A13061916AC0188C7328AC1D079784E7DA024700B739D6B1C6C3AB007B2AE9484A6FD57C16E9EC751781D059931ED6CFFF506C52B9CEE5D64D169112520D3E6CBBC4331010ED12E2BAFD72EA356DF34ED7AA3A6694E2795D3D1E58A680831A26FA219E1AD382BB0C881101A02AAA83BAF2804C9782DCD50488F956628E4B2AFC8E5423CA288E588EF22656CD4873BB829444EE5613ECF9C8DE40A4434BF5060C3267447F06F0321E62CF772B0FF063C9C4EC5656FFB1B1493DE41B0982788E6399CF0A84750708D192885363F4C69FA55545EAAA6D5B7D5F85F2D1D6C7DAF0CF00E0509EE5E94D0AC7541CDED348BD1341EC13B53C834AE63A680BF1103F2F39A0C354140FBEA748A3D12A67F5EC5F02BBFD1FDDE75161E4A017B28E08C7B06CE71371467297E2FAD849A5D3D03AD35407605AD30AEDC0AC0EF326B2C554132F432E85D3247B4A4CD12D96176CDA431096559142E9EE7EC3C40ABEA0BD43862990EC9A42BEEC172E9DC521FC7C1334088AEB8BC811738BCC771216214799C3CC2A236449CB907B50D97DA1FCBAD0FDB5B9F46B46A5BBF19969163EF01A0FDB2FDC7FACE657B24161E3316812E4E77A1F3824AF0A5E5799C51DFE97303207DA8D0DE8A5DC0CE9135EC15ECFCCCFD478D0A96A397CEA4347A714690073B7455C57C494F71803976D28D4CBD8E13C43CE4D7C51CA8EDCB25A0CB718C69FA4116CE8D0CB890505E57FC84A65F38821E4B52B00CCD483AD77254B5E614AF318804E53DF6D7643AC5BD427D4AE5C80A59BBA8389D082CDDC9E9F553620B6FB51C19255E2A95B215E7B65C46EF0AA76A97F03A9CA9DD9F5DE0C476AFBB5DE399B8E0AAAEAD9D716DD5ACC9E58389586C05E71AADE7D5F46BF77E9A4C45709CBF21536B1CD676DEEAF25E5566960E7DB68CDC75E9B44B4CDCBE965763E0F6FDDB3EE6CD8E15D087438FCAFB461CDD2386D372FCD4749D700B95D9D185E5D11F2AABA5B80BCC0B1F7D639698EB5487A8BA61AFB1AB8CA1FFB6DF04AAF5AA3B46A93EAD37A19652D081A2BBFDD6CCB466938CE0E53B680DB4A4211458812954ECAE6F9F42579B6FA62A47F73C4095F468E38A9AF8F43C2F0983956CACAA32999266546EF850D348D50E57DDDC5917165271793B95F4BEF94B51A5E31256C777A62E643F275258AC4EB23BB9CDC06D34D8A0DE44D5DD9FE9086AE2BED83B303542CA3AAC93881D2ECB300216577CA5392CEBA6932C483D2F984E34D1ECD30BB45E13BA12A2DBF312679185B69F7CB7B00FF30E338C89C71AA2BDCBD99623811A432BACD4A6DFEC7D7C4E62C60BF3EE3A277E586BA61A7F8D252A4693ED7B7DFF0AA354B44F7FE701A11D579E5A7D5751F51C161AA63E58BA662C3397AEAF93661CA000C50DDF0C4EA22009A9DE1FD4F7CEE3C44580BCC81C430AFA1691A40A73BC3CB05B44CA8B2C3094286D094CA93347CDAFC745B0BCC80AA388D256708A6273AC324E5B442A0BCD71B471DA22AEB691F9386AE8B608AFD65950A131425B2249630BF3119A42B845FCA67A73F45A40B7085DAB34C72D42BB45B8A2CC1C4589ED96548D5C6541CF7A88B744CE7AB50535C50F871225C50A733CF9E3A10828D7D411A71345DDD7CEC5353353BB6990AD96914DD39E2C463672BA936A2FAB670CF6426630BF4C96ECA0E682598FD212842C02B7347B677363362F1DE591D95A73623063636DE76D66DB261FC9DE3792627D55A8B2C2C6EE349986AAD4CABE5641BF8A6DAD2ACCF1F2D85F11292FB2599D10FC2B2F50A8785707C6EA4073BF31BECD53EF3CFB9ABB4E9C975119798C98648FB2220BB59345764A5A272BB210A2EA7B812448FACF087AAC77E6AFDF498DCFF8E28D7C5FA66FC5D85E86CFC32265460DEAB9C3ED18EF0C6FC9F0B58B4DB549397A79C1A95C644EF34BC5EEB73B6AB78C599334603D7A8403783C7317CF0C5C99FDB4C1FEE2D7E02420383DF6160D2E101C85416AB2F044F7C3C1E107E5C58FED797D63C2981F345CCA363EC1216FD82B043F2794FC9AE0F4D683A7CC170F7BFD823EA2D87B40F1DF42F4F4F7315EB4D0025ABF5A316C6ACD2F510C269EF42A0549397CE83B143EFCE623BC43D11BA7E31D8A3E8B6C7E85A2D8D0FA3B14765CD2F6E884325B1338FD13147D96AE7980621944C81E4C7E7FA21F46E3F313F7C41E48FBF4441FB0860C86DE0CDC94C1600836C643073B6801A4FCE73A5C2D3208168B9F66EEEF9BFE47CEFCDF5F33883DE73206E37EE41C38FF1DFF5582B6759A08F60EF2587340E13B4F192BBB71AD7D438A7E1F9BA026E8F75298F5E4FC3E539152F3FBADA59698FF76F47FEBB5D44E88A99405395CE8C52C66FFC5B3987B699512659062D94D7ED5DE28BD415E95B277FBB9D2EF0C69CC90E3676216E1B4AF9E3F6612613C5AFA67DF6C096D50DD2B264DEE44669A558EE476F05C19D6DB33317327784A1F59B07D3CD43BBBD16E275F548BD5B25386E7540E4CB4FD6619895B98C2355EFEE116B19C94B5342CEB716758ADFDBBF0B766B3E64CC17A4E81BAAFB5C4B5C224B6650266DF0CC1B3BC8F60FBF36BBC7BD344C136A7CA2A55503B8DBEC985A234B5A6176A471E9480689E7FD8B6F2C1C98A66B98A6D53D8A1A44699DD95E4947E398A0D695446DCB84D598A43C8A288901A33BA8B6988764B32F1D13AE3E47629B17030791AB48F269AEA45D205EBD1336089857F1F073C0246561544FAAFE550EC4936B86C33A7CBA8F0069419154DD44B1BCC910F06FA38E664893C0ED51E666CF3EF3CE46F669D85F7D89FD3CB84AF130E4BC6E17D20250FA52E45DBF89B9C4879CED3CB4DB8071B6309304D92DE335DD24F0909AAB7BECE1BEE993410A9AFF21386F26C2FC1F5E178F55C227DD93C3966029493AF74B16E70B80E008C5DD20512DE38B398DB2DC39FF10A79CF4510941EA47B2364B24F4F095AC528643946D51FFE041EF6C3A71FFE0F7F2A1253266A0000 , N'6.1.3-40302')
END

GO
