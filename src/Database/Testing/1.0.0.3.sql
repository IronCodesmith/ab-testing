--beginvalidatingquery
	if exists (select * from dbo.sysobjects where id = object_id(N'[dbo].[sp_DatabaseVersion]') and OBJECTPROPERTY(id, N'IsProcedure') = 1)
    begin
		 select 1, 'Upgrading database'
    end
    else
		select -1, 'Not an EPiServer database'
--endvalidatingquery

-- Create MultivariateTest Tables to Store MultivariateTest Information.
DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Testing.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '1'

IF @CurrentMigration < '201701191618065_KpiFinancialResultCultures'
BEGIN

ALTER TABLE [dbo].[tblABKeyPerformanceIndicator] ADD [PreferredCulture] [nvarchar](max) NOT NULL DEFAULT ''
ALTER TABLE [dbo].[tblABKeyFinancialResult] ADD [TotalMarketCulture] [nvarchar](max) NOT NULL DEFAULT ''
ALTER TABLE [dbo].[tblABKeyFinancialResult] ADD [ConvertedTotal] [decimal](18, 2) NOT NULL DEFAULT 0
ALTER TABLE [dbo].[tblABKeyFinancialResult] ADD [ConvertedTotalCulture] [nvarchar](max) NOT NULL DEFAULT ''
INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
VALUES (N'201701191618065_KpiFinancialResultCultures', N'Testing.Migrations.Configuration',  0x1F8B0800000000000400ED5D4B6FE43612BE2FB0FF41D06977E1B8ED994BD6E84EE0F12368643C36DC1EEF622F035A62B789485447941C1BC1FEB21CF293F62F6CA9F5E2439448496EBB612387B4F9F8C82A16AB4A6415E77F7FFC39FDF1310C9C071C3312D1997BB87FE03A987A914FE86AE6A6C9F2BBEFDD1F7FF8EB5FA6677EF8E8DC96ED3E66EDA0276533F73E49D6479309F3EE7188D87E48BC3862D132D9F7A27082FC68F2E1E0E09F93C3C309060817B01C677A9DD2848478F307FC7912510FAF93140517918F03569443CD6283EA7C4121666BE4E1997B764516388619EF5FA0F8179CC044F76F30DBFCFF1405AE731C1004D35AE060E93A88D22841094CFAE82BC38B248EE86AB1860214DC3CAD31B45BA280E18298A3BAB9295D071F32BA2675C712CA4B5912859680871F0B464DE4EEBDD8ED568C04569E01CB93A78CEA0D3B672E70EBF853C63AD791473B3A09E2AC6527BBF773D4CDB2ED57807B4ED164AF121990ACECBF3DE7240D9234C6338AD32446C19E7395DE05C4FB193FDD44BF603AA36910F0F38699439D5000455771B4C671F2748D97053573DF752662BF89DCB1EAC6F5C9C9FC2925F0FB0B8C8DEE025C49C5A4B5FB0D49025C22806C01C1AE73811E3F63BA4AEE672EFC749D73F288FDB2A480FD4A096C31E894C429B61EF614332F26EB5C2A060FDE3ED6E56F14C7DB27F132262B4251304F703870911620D1F5228152C8C43413CFA2C21E2E4E4E39C8ECF70DE8326BA433EA8F82730513221E596F36EE158E3D4C13B4AA70E734F9F8C11AF43362096C6AB224D8FFF4D422008707072388D9D9E31A7B09F66F092349149F44601F2402DA018EBDCC7AB474B7A41F2CD292F86009F167FC80836A91225056F64BF49F8517C57820C89C2DC88AC28A78A8A6EE53140518517BFA620CF2368E009672D20FEC0B7A20AB5C76455850DE20CDCB2806BBE4E139F58170585CE63AD738D87460F7645DEF694DFB6F9C993B8FA3F03A0A72DBD7D9FEDB0D8A5738637564D16911A5B005CDC9BC45318105D59255D46BC950EA9BA6AD366A9AE67452FB085D9E83861123BA129A11DE8A6F01440E84D0305046EDB02E315EE238C67EC1DBEDFB023BA0AAB8BDB92DDD54EE5F2BDD546A86BE9BBE5023236EF202F17D531B7B01C33DE20CA2E0F2302769CEFE4528F77DD0DB1989687102C1864DE896E0DF0642CCD946BCD83DF6DF808FD5A9B8ECBD8F06C5A477512CE6095BF31C3E09A94750708D192885364F506AFA8D575EB2A6D5B7D578802D1D6CBDBF1CF0160529EE268A6BD64A50733B0D319AC623F887129BC6750D25F03762407E5E93A12608785F7FCE628F84D99FE0E579A43802FEDE75161ECA00EDB5E7063D5FC297F31737D60414EFF3922A0EF362D416FB75A054EC86A9AA14DE73ABFD66E7DAC04E0CD0969C1E1E575372C0EF5AD2785705E9D0F3BAF79D39A2EFD2BC233B1C1DB3DD9886E25EE4EE06E6EC3C40ABFA92709C6D990DC9845B88C1FB128C888FE3E00920F88F1F71012F707887E3728B51E425E40188DA3071E61E280B2EB43F165B1FB6B73E8D68DD563DBC179163EF1EA0FDAAFD4775E5F235E20B8F198B401767ABD07928C97DBD88F338A3BED3E7CC45B84BD29E845EC0CA9135AC15ACFCCCFD87C205CBD12BF75D18BDFC2A13073B7465C57C494F718013EC640B99393F278879C857B73970DB174BAEB313404CB33B73707A184821A189AAF809CD2EA1821E2449588666249B6B35AA5C738AD718B6044D7AACAFC974CA931C754AD5C8125BBBB8389D7022DD29E9EA77798B6CB57CA40BB25429652BC96DB980D81549D592B01DC9D4AECF2E4862BBD7DDAEF14C5C7059D72AA70AB66AD6E4B8C7645BBC0AC935A2676BFAB57B3D4DA6C239CE2F28D41A87B55DB6BABC575998858F3E5B41EE3AE6DB25216EA7656B02DCBE7EAF4F78F3CF0AE893408FDAFB4609BA430C67E5F8B1E938E12B54E69F2EAC387792452DC35DE0A4F4D1376689B94EFD11A51A76455C450C7D3C4713A8D6ABEE18A50EA76842AD7641078AEEBE413353C52619C18BA7FE1A68414348B09C50C8D85DB7CD5C579B5B6A59A27B7E4055FC68930A65FBF4FC5EE206ABC45856652227CDB8DC7035D6C8D50E57DDDC59E708A9A5BC9D4B7ADFFCB9B8D27108AB933B5317B29F13C911ABDBD99DD266E0361A2C506FA6EACECF740C35715FEC1D188591A20EEB646287CB328C81E5115F650EABBAE924CF23280AA6134DC2C1F402ADD784AEB80484A2C459E4D90727DF2DEC23F1C31C63E2B18680FC6AB6D548A0C6D00A4BB5D985938FCF49CC92D2BCBBCE891F2ACD64E3AFB144E568A27D57D7AF344A65FBEC7711B3DB71E4A9D5773557CF81D030F3C1329AB1285CBABE4E961482021437DC199C44411A52BD3FA8EF5D84F2F300459139861097CF230915E67845EC3D8F541459604881F4029854678E5A1C8FF3604591154619482FE194C5E65855283D8F54159AE36843E9795C6D23F371E4E87A1E5EAEB3E0426310BDC092C616E6233445D9F3F84DF5E6E84ACC3D0FAD549AE396D1F73C5C59668E2285DF0BAA46ACB2A098BFDC13A8E52BCCF1C40B3E1E50AC5111A71349252BDFAE8A29504E0344CB626477B4DEFFC88648F735D9CB3219833D93A92A0E7C055BA53904D6A3B40487F3C02DCD2CD4AA12432EE853A5F67D03196FA0CA4D1E79C368BE17CC3688B6F36BDE104D1E92BD6724C456CB5055858DD52943AC458353965A59D73AC85AB2AC7585395E116BCD23154536D471C1D622815CC5BB3A3056079AD38DF1ADA97CE2D9D79076E23C8FCA2822C4044B971759A89D3CBC54D03A79912586142FAB004AF5B65BBE8E8455777D5DD717B571DA9A2616CAA5BE4511148CFE72A565BEEF4A4139A91B5F21F0F7147D95412BC6EB550445B0A828A8819AF4DE8EF12EF09602AF1CF7CA4DAAD1AB635FE978775A1CB5763F3AA39CBDE64DB26C82E881F8D9B9EBE289818BB79F35D85FFC1A9C040467870165830B44C912764D1EB4E97E3838FC203D55F37A9E8D9930E6070D47D58D6FC7880BB68590F094925F539C9D052599F0C5C39E6DA10F28F6EE51FCB7103DFE7D8CA758B480D6CFAD0C9B5AF3132A8399273CA74232091FFA808A0FBF93111E50E98DD3F1804A1F229B9F4F2917547D40C54E4ADA5E4B91666B02A77F3BA50FE99A9753964184ECC1C48753FA6134BE9B72477A50A6A662F496B9A6540C43B0315EE9D841A52DA4CEAB704A8813108B1F67EEEF9BFE47CEFCDFDF72883DE732067B7CE41C38FF1DFF498D363A4DF6A2EEB98D61B6600725B739DEF25D528DB5DEB866BFE1CD883EC6417E31A2971A565F8BE83315E1AD887EB4282F45BC1DABD27A6EB713DB5448121DBEE9F95C737F7B69F503ED4263AAFCE8D36F4D951F46819264DB4BDF56288354EE6EEE64EDA1DB1BDCC542DA77BFAF8D77813416C8F15378CB38ECAD271E9A84A68F9637DC37CD461B8DB9C56CDB9D4869B44AAE7D1D3257C583F7CCE8DD0999D207A5BC3E19EA9D166BB792CFAAC594B4A6E1C9B80333B45F2C95F515E6FE8D97B8FA8A444E48771B962EBB33A2D67E75FED262D69C62AA26A3C8EBAA643C9626B12D8534BF5605CFF22E82E52F8E4DEF4C334CDB9C2AAB1C53ED34FA66A5F2BBA9352F553BF2A0CC55F3C4D536CA0767B99A25B9B64D6187B261457197B29ABA33E5DAA4B82B107D949CC3674A6F1DC216690BC9E1C663A55A6E337FD58E24131FAD33C4722C366D232375307B1AB48F26E0CC9C2D1679A66A80115862EEDFBE028F8091550D91FD4B58147B820DAEDACCE9322ABD0169466513F9D00627C807037D1C276489BC04AA3DCCD8E669D2E2B1B5B3F00EFB737A9926EB340192717817085967994BD136FE2699569CF3F4721311C3C62001A649B273A64BFA292541FD48DC79C339930622F3557EC2509EAF25B83E095E3D55485F366FD5990015ECAB5CAC1B1CAE030063977481B8C7F12CE6F695E1CF7885BCA7324E4C0FD2BD1022DBA7A704AD6214B202A3EE0F7F820CFBE1E30FFF07941B2D23026E0000 , N'6.1.3-40302')

END

GO

